<?xml version="1.0" encoding="ISO-8859-1"?>
<ui:composition
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://java.sun.com/jsf/core">
	
  	<p:tabView id="tabview" dynamic="false">

		<p:tab id="tabAgenda" title="Agenda" >
		
			<ui:include src="/pages/mensagem/agenda.xhtml" />
			
		</p:tab>
		
		<p:tab id="tabMensagem" title="Mensagem" >
		
		  	<h:form id="formMensagem">
		  	
				<p:poll interval="60" listener="#{mensagemFaces.pesquisarMensagens}" update="dgMensagem" process="@this" global="false" />
		  	
		  		<p:commandButton type="button" value="Nova Mensagem" onclick="dlgMensagem.show();" style="margin-bottom: 10px; margin-top:10px"/>
		  
		  		<p:remoteCommand name="abrirModelMensagem" oncomplete="dlgViewMensagem.show();" update="pgMensagem, dgMensagem" process="@this" global="false" />
		  		
			    <p:dataGrid id="dgMensagem" var="mensagemDestinatario" value="#{mensagemFaces.mensagensDestinatarios}" columns="3"  
			        rows="12" paginator="true"  paginatorAlwaysVisible="false" emptyMessage="Nenhuma mensagem encontrada"
			        paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"  
			        rowsPerPageTemplate="9,12,15">  
			          
			        <p:column>  
			            <p:panel>  
			                <h:panelGrid columns="2" columnClasses="coluna25_2, coluna75_2" style="width:100%; vertical-align: top">
			                    
			                    <h:outputText value="Data:" styleClass="#{mensagemDestinatario.css}"/>
			                    <h:outputText value="#{mensagemDestinatario.mensagem.data}" styleClass="#{mensagemDestinatario.css}">
			                    	<f:convertDateTime pattern="dd/MM/yyyy HH:mm" locale="pt_BR" timeZone="America/Sao_Paulo" />
		                    	</h:outputText>  
			                      
			                    <h:outputText value="Remetente:" styleClass="#{mensagemDestinatario.css}"/>
			                    <h:outputText value="#{mensagemDestinatario.mensagem.remetente.nome}" styleClass="#{mensagemDestinatario.css}"/>
			                      
			                    <h:outputText value="Mensagem:" styleClass="#{mensagemDestinatario.css}"/>
			                    <h:panelGrid columns="2">
			                    	<h:outputText value="#{mensagemDestinatario.mensagem.textoResumo}" style="text-align: lef;" styleClass="#{mensagemDestinatario.css}"/>
			                    	<p:commandLink action="#{mensagemFaces.lerMensagem}" oncomplete="abrirModelMensagem();" process="@this" global="false" value="Detalhe" style="text-align: lef; color: #0000FF">
			                    		<f:setPropertyActionListener target="#{mensagemFaces.mensagemDestinatarioSelecionada}" value="#{mensagemDestinatario}"/>
			                    	</p:commandLink>
			                    </h:panelGrid>
			                    
			                </h:panelGrid>
			            </p:panel>  
			        </p:column>  
			  
			    </p:dataGrid>  
			      
			    <p:dialog id="dialogViewMensagem" header="Detalhe da mensagem" widgetVar="dlgViewMensagem" modal="true" width="550" appendToBody="true">  
			        
		            <h:panelGrid id="pgMensagem" columns="2" columnClasses="coluna15_2, coluna85_2" style="width:100%; vertical-align: top">
		                    
		                <h:outputText value="Data:" />  
		                <h:inputText value="#{mensagemFaces.mensagemDestinatarioSelecionada.mensagem.data}" readonly="true">
		                	<f:convertDateTime pattern="dd/MM/yyyy HH:mm" locale="pt_BR" timeZone="America/Sao_Paulo" />
		                </h:inputText>
		                  
		                <h:outputText value="Remetente:" />
		                <h:inputText value="#{mensagemFaces.mensagemDestinatarioSelecionada.mensagem.remetente.nome}" readonly="true" style="width: 70%"/>
		                  
		                <h:outputText value="Mensagem:" />
		                <h:inputTextarea value="#{mensagemFaces.mensagemDestinatarioSelecionada.mensagem.texto}" rows="10" cols="65" style="text-align: lef; wudth: 100%" readonly="true"/>
		                  
		            </h:panelGrid> 
		            
		            <div style="text-align: right">
		            	<p:commandButton value="Responder" oncomplete="dlgMensagem.show(); dlgViewMensagem.hide();" action="#{mensagemFaces.addDestinatario}" process="@this" style="margin-right: 25px; margin-bottom: 20px">
		            		<f:setPropertyActionListener target="#{mensagemFaces.destinatarioSelecionado}" value="#{mensagemFaces.mensagemDestinatarioSelecionada.mensagem.remetente}" />
		            	</p:commandButton>
		            </div>
			              
			    </p:dialog>
			  
			</h:form>
			
		</p:tab>
		
	</p:tabView>
  	
</ui:composition>